# Результаты тестирования обученной NanoDet модели

## Методология тестирования

- **Модель**: `nanodet_320_simplified.onnx` (обученная модель для детекции автомобилей)
- **Количество изображений**: 27 (рандомный выбор из 30)
- **Конфиденс порог**: 0.35
- **Тестируемые разрешения**: 192x192, 256x256, 320x320
- **Примечание**: Модель обучена на 320x320, поэтому входные изображения ресайзятся до нужного размера, а затем до 320x320 для инференса

## Результаты по разрешениям

### 192x192

| Метрика | Значение |
|---------|----------|
| **Среднее время** | **151.3 ms** |
| **Минимум** | 110.2 ms |
| **Максимум** | 295.2 ms |
| **Теоретический FPS** | **6.6** |
| **Найдено авто** | **0/27 (0.0%)** |
| **Не найдено** | 27/27 (100.0%) |
| **Всего детекций** | 0 |
| **Детекций на изображение** | 0.0 |
| **Средняя уверенность** | 0.00 |

**Вывод**: Модель не работает на разрешении 192x192. Причина: модель обучена на 320x320, и двойной ресайз (192→320) приводит к потере критической информации.

### 256x256

| Метрика | Значение |
|---------|----------|
| **Среднее время** | 157.1 ms |
| **Минимум** | 115.9 ms |
| **Максимум** | 327.3 ms |
| **Теоретический FPS** | 6.4 |
| **Найдено авто** | **6/27 (22.2%)** |
| **Не найдено** | 21/27 (77.8%) |
| **Всего детекций** | 18 |
| **Детекций на изображение** | 0.7 |
| **Средняя уверенность** | 0.74 |

**Вывод**: Частично работает, но качество низкое. Только 22.2% изображений с авто найдено.

### 320x320 (нативное разрешение модели)

| Метрика | Значение |
|---------|----------|
| **Среднее время** | 156.1 ms |
| **Минимум** | 114.3 ms |
| **Максимум** | 312.4 ms |
| **Теоретический FPS** | **6.4** |
| **Найдено авто** | **9/27 (33.3%)** |
| **Не найдено** | 18/27 (66.7%) |
| **Всего детекций** | 37 |
| **Детекций на изображение** | 1.4 |
| **Средняя уверенность** | 0.77 |

**Вывод**: Лучшее качество среди всех разрешений, но все еще низкое (33.3%). Это нативное разрешение модели.

## Сравнительная таблица

| Разрешение | Время (ms) | FPS  | Найдено % | Детекций/изобр | Уверенность |
|------------|------------|------|-----------|----------------|-------------|
| **192x192** | **151.3**   | **6.6** | **0.0%**  | 0.0           | 0.00        |
| **256x256** | 157.1      | 6.4     | 22.2%     | 0.7           | 0.74        |
| **320x320** | 156.1      | 6.4     | **33.3%** | **1.4**      | **0.77**    |

## Анализ результатов

### Производительность

- **Время инференса**: ~150-160ms для всех разрешений
- **FPS**: ~6.4-6.6 FPS
- **Вывод**: Время практически не зависит от разрешения входного изображения, так как модель всегда работает на 320x320

### Качество обнаружения

- **192x192**: 0% - модель не работает
- **256x256**: 22.2% - частично работает
- **320x320**: 33.3% - лучшее качество, но все еще низкое

**Проблема**: Низкое качество обнаружения (33.3%) может быть связано с:
1. Модель обучена на специфическом датасете
2. Конфиденс порог 0.35 может быть слишком высоким
3. Проблемы с декодированием координат при двойном ресайзе
4. Модель может требовать другой предобработки

### Сравнение с предобученной моделью (из model zoo)

| Модель | Разрешение | Время (ms) | FPS  | Найдено % | Детекций/изобр |
|--------|------------|------------|------|-----------|----------------|
| **Model Zoo NanoDet** | 192x192 | 30.5 | 32.8 | 85.2% | 3.2 |
| **Model Zoo NanoDet** | 256x256 | 41.3 | 24.2 | 85.2% | 3.8 |
| **Model Zoo NanoDet** | 320x320 | 73.7 | 13.6 | 92.6% | 5.6 |
| **Обученная модель** | 192x192 | 151.3 | 6.6 | 0.0% | 0.0 |
| **Обученная модель** | 256x256 | 157.1 | 6.4 | 22.2% | 0.7 |
| **Обученная модель** | 320x320 | 156.1 | 6.4 | 33.3% | 1.4 |

**Вывод**: 
- Обученная модель работает **в 2-5 раз медленнее** предобученной
- Качество обнаружения **значительно ниже** (33.3% vs 92.6%)
- Предобученная модель находит **в 3-4 раза больше** детекций на изображение

## Рекомендации

### Для улучшения качества обученной модели:

1. **Проверить предобработку**:
   - Убедиться, что нормализация соответствует обучению
   - Проверить порядок каналов (RGB vs BGR)

2. **Снизить конфиденс порог**:
   - Попробовать 0.25 или 0.20 вместо 0.35
   - Может увеличить количество найденных объектов

3. **Проверить декодирование координат**:
   - Убедиться, что координаты правильно преобразуются из координат модели в координаты исходного изображения
   - Проверить работу NMS

4. **Использовать нативное разрешение**:
   - Всегда использовать 320x320 для обученной модели
   - Не использовать ресайз до меньших разрешений

5. **Оптимизация модели**:
   - Конвертировать в NCNN для ускорения
   - Использовать квантизацию для уменьшения размера и ускорения

### Для реального использования:

- **Использовать предобученную модель из model zoo** для лучшего качества и скорости
- **Или дообучить модель** на большем датасете с правильной предобработкой
- **Конвертировать в NCNN** для ускорения на Raspberry Pi

## Выводы

1. **Обученная модель работает медленнее** предобученной (в 2-5 раз)
2. **Качество обнаружения низкое** (33.3% vs 92.6%)
3. **Модель не работает** на разрешениях меньше 320x320
4. **Рекомендуется использовать нативное разрешение** 320x320
5. **Требуется доработка** предобработки и декодирования для улучшения качества

## Файлы результатов

- Мозаики сравнения сохранены в: `output_trained_nanodet/`
- Каждое изображение содержит результаты для всех трех разрешений рядом

