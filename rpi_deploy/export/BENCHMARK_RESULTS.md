# Результаты бенчмарка обученной NanoDet модели

## Конфигурация

- **Устройство**: Raspberry Pi 4
- **CPU**: ARM Cortex-A72, 4 ядра
- **Модель**: nanodet_320_simplified.onnx (обученная на детекцию автомобилей)
- **Входной размер**: 320x320
- **Тест**: 50 итераций, 20 warmup

## Результаты

| Модель | Время (ms) | FPS | Примечание |
|--------|------------|-----|------------|
| **Model Zoo (NanoDet-M)** | **48.9** | **20.4** | Предобученная COCO, оптимизированная |
| NCNN (pnnx) | 97.5 | 10.3 | Конвертированная через pnnx |
| NCNN (ncnnoptimize) | 99.0 | 10.1 | Оптимизированная ncnnoptimize |
| ONNX Runtime | 103.7 | 9.6 | Оригинальная ONNX |

## Анализ

### Почему Model Zoo быстрее?

1. **Меньшая архитектура**: NanoDet-M из Model Zoo оптимизирована для скорости
2. **Полная оптимизация**: Модель специально подготовлена для NCNN
3. **Включает декодирование**: Даже с декодированием и NMS работает в 2x быстрее

### Почему обученная модель медленнее?

1. **Более тяжелая архитектура**: Возможно, при обучении использовалась более сложная версия NanoDet
2. **Конвертация не оптимальна**: pnnx не полностью оптимизирует модель
3. **Не хватает низкоуровневых оптимизаций**: Model Zoo использует специальные оптимизации для ARM

## Рекомендации

### Для достижения 20 FPS:

1. **Использовать Model Zoo NanoDet-M** для детекции автомобилей
   - 48.9 ms (20.4 FPS)
   - Качество: 85-93% на разрешениях 192-320

2. **Переобучить на архитектуре NanoDet-M**
   - Использовать такую же архитектуру как в Model Zoo
   - Экспортировать с правильными оптимизациями

3. **Уменьшить разрешение для обученной модели**
   - 192x192 или 256x256
   - Но качество упадет

### Для каскадного подхода:

| Этап | Модель | Разрешение | Время (ms) | Цель |
|------|--------|------------|------------|------|
| 1. Детекция авто | Model Zoo NanoDet-M | 192x192 | ~30 | Быстрое сканирование |
| 2. Детекция номера | Обученная NanoDet | 320x320 | ~100 | Точная детекция на ROI |
| 3. OCR | Специальная модель | ~100x300 | ~20 | Распознавание символов |

**Общее время каскада**: ~150ms (6-7 FPS)

## Файлы

- `nanodet_320_simplified.onnx` - Оригинальная ONNX модель
- `nanodet_320_simplified.ncnn.param/.bin` - NCNN модель (pnnx)
- `nanodet_320_opt.param/.bin` - Оптимизированная NCNN модель
- `inference_ncnn_complete.py` - Полный пример инференса

## Выводы

1. **Обученная модель работает на ~10 FPS** — медленнее ожидаемого
2. **Model Zoo даёт 20 FPS** — использовать для детекции авто
3. **Конвертация в NCNN не ускорила** — проблема в архитектуре модели
4. **Для реального времени нужен каскадный подход** или переобучение на меньшей архитектуре

